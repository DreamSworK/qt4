<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Qt 4.8: /src/corelib/thread/qthread_win.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="qt_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Qt 4.8
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_1427e6b9e14483d8a13b4ea1c69420e3.html">qt-4.8.6</a></li><li class="navelem"><a class="el" href="dir_42c0970699667688278d00b1a5e7112e.html">src</a></li><li class="navelem"><a class="el" href="dir_3a58f461b121672b370de56a44759be9.html">corelib</a></li><li class="navelem"><a class="el" href="dir_586020c269423ccd9a4cf5d8b873e2b2.html">thread</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">qthread_win.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="qthread_8h_source.html">qthread.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="qthread__p_8h_source.html">qthread_p.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="qthreadstorage_8h_source.html">qthreadstorage.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="qmutex_8h_source.html">qmutex.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="qcoreapplication_8h_source.html">qcoreapplication.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="qpointer_8h_source.html">qpointer.h</a>&gt;</code><br />
<code>#include &lt;private/qcoreapplication_p.h&gt;</code><br />
<code>#include &lt;private/qeventdispatcher_win_p.h&gt;</code><br />
<code>#include &lt;<a class="el" href="qt__windows_8h_source.html">qt_windows.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="qfunctions__wince_8h_source.html">qfunctions_wince.h</a>&quot;</code><br />
</div>
<p><a href="qthread__win_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ac50762666aa00bd3a4308158510f1748"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#ac50762666aa00bd3a4308158510f1748">_WIN32_WINNT</a>&#160;&#160;&#160;0x0400</td></tr>
<tr class="separator:ac50762666aa00bd3a4308158510f1748"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6a9804f278dccdd88babcea470c4836d"><td class="memItemLeft" align="right" valign="top">DWORD WINAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a6a9804f278dccdd88babcea470c4836d">qt_adopted_thread_watcher_function</a> (LPVOID)</td></tr>
<tr class="memdesc:a6a9804f278dccdd88babcea470c4836d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function loops and waits for native adopted threads to finish.  <a href="#a6a9804f278dccdd88babcea470c4836d">More...</a><br /></td></tr>
<tr class="separator:a6a9804f278dccdd88babcea470c4836d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15ddb408c5845e2612a250750289c242"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a15ddb408c5845e2612a250750289c242">qt_create_tls</a> ()</td></tr>
<tr class="memdesc:a15ddb408c5845e2612a250750289c242"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the <a class="el" href="classQThread.html" title="The QThread class provides a platform-independent way to manage threads. ">QThread</a> system.  <a href="#a15ddb408c5845e2612a250750289c242">More...</a><br /></td></tr>
<tr class="separator:a15ddb408c5845e2612a250750289c242"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa915ec62599a2134249c9a4a17cd8309"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#aa915ec62599a2134249c9a4a17cd8309">qt_free_tls</a> ()</td></tr>
<tr class="separator:aa915ec62599a2134249c9a4a17cd8309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9447f5f4c4ae07dfe57b796bc010d1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#ac9447f5f4c4ae07dfe57b796bc010d1b">qt_watch_adopted_thread</a> (const HANDLE adoptedThreadHandle, <a class="el" href="classQThread.html">QThread</a> *qthread)</td></tr>
<tr class="memdesc:ac9447f5f4c4ae07dfe57b796bc010d1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds an adopted thread to the list of threads that <a class="el" href="namespaceQt.html">Qt</a> watches to make sure the thread data is properly cleaned up.  <a href="#ac9447f5f4c4ae07dfe57b796bc010d1b">More...</a><br /></td></tr>
<tr class="separator:ac9447f5f4c4ae07dfe57b796bc010d1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9b7c1454bb5a5c334bb45508dc27eb42"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classQVector.html">QVector</a>&lt; <a class="el" href="classQThread.html">QThread</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a></td></tr>
<tr class="separator:a9b7c1454bb5a5c334bb45508dc27eb42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8495d64416823fd6ad3da3b12de0032f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classQVector.html">QVector</a>&lt; HANDLE &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a></td></tr>
<tr class="separator:a8495d64416823fd6ad3da3b12de0032f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4263225c63d4c2a778fdbe3a1b36d84f"><td class="memItemLeft" align="right" valign="top">static HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a> = 0</td></tr>
<tr class="separator:a4263225c63d4c2a778fdbe3a1b36d84f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a354f28b2077ff92dc5cf7df1f9503c0d"><td class="memItemLeft" align="right" valign="top">static DWORD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a> = 0</td></tr>
<tr class="separator:a354f28b2077ff92dc5cf7df1f9503c0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41ec7eac106dfdd48d235e69dc6f9d46"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classQMutex.html">QMutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a></td></tr>
<tr class="separator:a41ec7eac106dfdd48d235e69dc6f9d46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac99862afc48487079933197e551ca73b"><td class="memItemLeft" align="right" valign="top">static DWORD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a> = <a class="el" href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a></td></tr>
<tr class="separator:ac99862afc48487079933197e551ca73b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ac50762666aa00bd3a4308158510f1748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac50762666aa00bd3a4308158510f1748">&#9670;&nbsp;</a></span>_WIN32_WINNT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _WIN32_WINNT&#160;&#160;&#160;0x0400</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00044">44</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6a9804f278dccdd88babcea470c4836d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a9804f278dccdd88babcea470c4836d">&#9670;&nbsp;</a></span>qt_adopted_thread_watcher_function()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DWORD WINAPI qt_adopted_thread_watcher_function </td>
          <td>(</td>
          <td class="paramtype">LPVOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function loops and waits for native adopted threads to finish. </p>
<dl class="section warning"><dt>Warning</dt><dd>This function is not part of the public interface.</dd></dl>
<p>When this happens it derefs the <a class="el" href="classQThreadData.html">QThreadData</a> for the adopted thread to make sure it gets cleaned up properly. </p>

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00211">211</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00176">qt_watch_adopted_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="qglobal_8h.html#a8c25998f80abf59bbbc3fd3011d8bba6">forever</a> {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>.<a class="code" href="classQMutex.html#ab503e77f0c222bc4b90084a9937391e9">lock</a>();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>.<a class="code" href="classQVector.html#ae640c66ae6f1507c6a27f0339df34efa">count</a>() == 1) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a> = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>.<a class="code" href="classQMutex.html#a3d8f31a43c7e73ff4d95dd61fa9df82c">unlock</a>();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <a class="code" href="classQVector.html">QVector&lt;HANDLE&gt;</a> handlesCopy = <a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>.<a class="code" href="classQMutex.html#a3d8f31a43c7e73ff4d95dd61fa9df82c">unlock</a>();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        DWORD ret = WAIT_TIMEOUT;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordtype">int</span> count;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordtype">int</span> offset;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordtype">int</span> loops = handlesCopy.<a class="code" href="classQVector.html#a3b40ac78d8377b150a0467a7fe139eef">size</a>() / MAXIMUM_WAIT_OBJECTS;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span> (handlesCopy.<a class="code" href="classQVector.html#a3b40ac78d8377b150a0467a7fe139eef">size</a>() % MAXIMUM_WAIT_OBJECTS)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            ++loops;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">if</span> (loops == 1) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="comment">// no need to loop, no timeout</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            offset = 0;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            count = handlesCopy.<a class="code" href="classQVector.html#ae640c66ae6f1507c6a27f0339df34efa">count</a>();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            ret = WaitForMultipleObjects(handlesCopy.<a class="code" href="classQVector.html#ae640c66ae6f1507c6a27f0339df34efa">count</a>(), handlesCopy.<a class="code" href="classQVector.html#a21bff276e9616d79bbce50ac4e6fce93">constData</a>(), <span class="keyword">false</span>, INFINITE);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordtype">int</span> loop = 0;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                offset = loop * MAXIMUM_WAIT_OBJECTS;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                count = <a class="code" href="qglobal_8h.html#a6d0450aa696b2c3684c16be18edd169a">qMin</a>(handlesCopy.<a class="code" href="classQVector.html#ae640c66ae6f1507c6a27f0339df34efa">count</a>() - offset, MAXIMUM_WAIT_OBJECTS);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                ret = WaitForMultipleObjects(count, handlesCopy.<a class="code" href="classQVector.html#a21bff276e9616d79bbce50ac4e6fce93">constData</a>() + offset, <span class="keyword">false</span>, 100);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                loop = (loop + 1) % loops;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            } <span class="keywordflow">while</span> (ret == WAIT_TIMEOUT);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (ret == WAIT_FAILED || ret &gt;= <a class="code" href="qfunctions__wince_8h.html#abb2c63c1933cab709a4fd4aef2012bbb">WAIT_OBJECT_0</a> + <a class="code" href="qglobal_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>(count)) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <a class="code" href="qglobal_8h.html#ac70e1c2698aa808d9baf4bda9e9ee891">qWarning</a>(<span class="stringliteral">&quot;QThread internal error while waiting for adopted threads: %d&quot;</span>, <span class="keywordtype">int</span>(GetLastError()));</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> handleIndex = offset + ret - <a class="code" href="qfunctions__wince_8h.html#abb2c63c1933cab709a4fd4aef2012bbb">WAIT_OBJECT_0</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (handleIndex == 0){</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="comment">// New handle to watch was added.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">//             printf(&quot;(qt) - qt_adopted_thread_watcher_function... called\n&quot;);</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> qthreadIndex = handleIndex - 1;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>.<a class="code" href="classQMutex.html#ab503e77f0c222bc4b90084a9937391e9">lock</a>();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <a class="code" href="classQThreadData.html">QThreadData</a> *<a class="code" href="qdbusmessage_8cpp.html#a4b86149e51ff4431f59ce6148820fb86">data</a> = <a class="code" href="classQThreadData.html#a58cb0e49ae8ee1830ca8bd9a4d2f4ef7">QThreadData::get2</a>(<a class="code" href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a>.at(qthreadIndex));</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>.<a class="code" href="classQMutex.html#a3d8f31a43c7e73ff4d95dd61fa9df82c">unlock</a>();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">if</span> (data-&gt;<a class="code" href="classQThreadData.html#a6532273b49c059949abb65e5e0eaf6e8">isAdopted</a>) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <a class="code" href="classQThread.html">QThread</a> *thread = data-&gt;<a class="code" href="classQThreadData.html#ac9aa336d53cb2749ffb38dba01a94265">thread</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <a class="code" href="qglobal_8h.html#ac29a7ecc02f777dfeb2b68a051561c35">Q_ASSERT</a>(thread);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <a class="code" href="classQThreadPrivate.html">QThreadPrivate</a> *thread_p = <span class="keyword">static_cast&lt;</span><a class="code" href="classQThreadPrivate.html">QThreadPrivate</a> *<span class="keyword">&gt;</span>(<a class="code" href="classQObjectPrivate.html#abee9e6f66c8f9c360f98995df6539df5">QObjectPrivate::get</a>(thread));</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <a class="code" href="qglobal_8h.html#ac29a7ecc02f777dfeb2b68a051561c35">Q_ASSERT</a>(!thread_p-&gt;<a class="code" href="classQThreadPrivate.html#aafd7888a95ed3d66521d36e703fbd417">finished</a>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                thread_p-&gt;<a class="code" href="classQThreadPrivate.html#a5024ce3be48b6aa59109c3cc4b55be97">finish</a>(thread);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            data-&gt;<a class="code" href="classQThreadData.html#a4c9e901f1206c2398316b15b5b38e5f6">deref</a>();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <a class="code" href="classQMutexLocker.html">QMutexLocker</a> <a class="code" href="namespaceMaemo.html#a06dd0ab7853d64c18382e2c13c5eecc8">lock</a>(&amp;<a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#if !defined(Q_OS_WINCE) || (defined(_WIN32_WCE) &amp;&amp; (_WIN32_WCE&gt;=0x600))</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            CloseHandle(<a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>.<a class="code" href="classQVector.html#a089ac11f22dec7de12a9ac819ab15175">at</a>(handleIndex));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>.<a class="code" href="classQVector.html#a795fabfd2431ce0878ff4ba3c06e7e2b">remove</a>(handleIndex);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a>.remove(qthreadIndex);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="classQThreadData.html">QThreadData</a> *threadData = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classQThreadData.html">QThreadData</a> *<span class="keyword">&gt;</span>(TlsGetValue(<a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a>));</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (threadData)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        threadData-&gt;<a class="code" href="classQThreadData.html#a4c9e901f1206c2398316b15b5b38e5f6">deref</a>();</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div><div class="ttc" id="qglobal_8h_html_a6d0450aa696b2c3684c16be18edd169a"><div class="ttname"><a href="qglobal_8h.html#a6d0450aa696b2c3684c16be18edd169a">qMin</a></div><div class="ttdeci">Q_DECL_CONSTEXPR const T &amp; qMin(const T &amp;a, const T &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="qglobal_8h_source.html#l01215">qglobal.h:1215</a></div></div>
<div class="ttc" id="classQMutex_html_ab503e77f0c222bc4b90084a9937391e9"><div class="ttname"><a href="classQMutex.html#ab503e77f0c222bc4b90084a9937391e9">QMutex::lock</a></div><div class="ttdeci">void lock()</div><div class="ttdoc">Locks the mutex. </div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8cpp_source.html#l00151">qmutex.cpp:151</a></div></div>
<div class="ttc" id="classQVector_html_a795fabfd2431ce0878ff4ba3c06e7e2b"><div class="ttname"><a href="classQVector.html#a795fabfd2431ce0878ff4ba3c06e7e2b">QVector::remove</a></div><div class="ttdeci">void remove(int i)</div><div class="ttdoc">Removes the element at index position i. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00374">qvector.h:374</a></div></div>
<div class="ttc" id="classQVector_html_ae640c66ae6f1507c6a27f0339df34efa"><div class="ttname"><a href="classQVector.html#ae640c66ae6f1507c6a27f0339df34efa">QVector::count</a></div><div class="ttdeci">int count(const T &amp;t) const</div><div class="ttdoc">Returns the number of occurrences of value in the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00742">qvector.h:742</a></div></div>
<div class="ttc" id="classQThreadData_html"><div class="ttname"><a href="classQThreadData.html">QThreadData</a></div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00209">qthread_p.h:209</a></div></div>
<div class="ttc" id="classQThreadData_html_a6532273b49c059949abb65e5e0eaf6e8"><div class="ttname"><a href="classQThreadData.html#a6532273b49c059949abb65e5e0eaf6e8">QThreadData::isAdopted</a></div><div class="ttdeci">bool isAdopted</div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00269">qthread_p.h:269</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_ac99862afc48487079933197e551ca73b"><div class="ttname"><a href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a></div><div class="ttdeci">static DWORD qt_current_thread_data_tls_index</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00077">qthread_win.cpp:77</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a41ec7eac106dfdd48d235e69dc6f9d46"><div class="ttname"><a href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a></div><div class="ttdeci">static QMutex qt_adopted_thread_watcher_mutex</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00164">qthread_win.cpp:164</a></div></div>
<div class="ttc" id="qglobal_8h_html_ac29a7ecc02f777dfeb2b68a051561c35"><div class="ttname"><a href="qglobal_8h.html#ac29a7ecc02f777dfeb2b68a051561c35">Q_ASSERT</a></div><div class="ttdeci">#define Q_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="qglobal_8h_source.html#l01823">qglobal.h:1823</a></div></div>
<div class="ttc" id="qfunctions__wince_8h_html_abb2c63c1933cab709a4fd4aef2012bbb"><div class="ttname"><a href="qfunctions__wince_8h.html#abb2c63c1933cab709a4fd4aef2012bbb">WAIT_OBJECT_0</a></div><div class="ttdeci">#define WAIT_OBJECT_0</div><div class="ttdef"><b>Definition:</b> <a href="qfunctions__wince_8h_source.html#l00302">qfunctions_wince.h:302</a></div></div>
<div class="ttc" id="classQVector_html"><div class="ttname"><a href="classQVector.html">QVector&lt; HANDLE &gt;</a></div></div>
<div class="ttc" id="classQThreadPrivate_html_aafd7888a95ed3d66521d36e703fbd417"><div class="ttname"><a href="classQThreadPrivate.html#aafd7888a95ed3d66521d36e703fbd417">QThreadPrivate::finished</a></div><div class="ttdeci">bool finished</div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00148">qthread_p.h:148</a></div></div>
<div class="ttc" id="classQObjectPrivate_html_abee9e6f66c8f9c360f98995df6539df5"><div class="ttname"><a href="classQObjectPrivate.html#abee9e6f66c8f9c360f98995df6539df5">QObjectPrivate::get</a></div><div class="ttdeci">static QObjectPrivate * get(QObject *o)</div><div class="ttdef"><b>Definition:</b> <a href="qobject__p_8h_source.html#l00177">qobject_p.h:177</a></div></div>
<div class="ttc" id="classQThreadData_html_a4c9e901f1206c2398316b15b5b38e5f6"><div class="ttname"><a href="classQThreadData.html#a4c9e901f1206c2398316b15b5b38e5f6">QThreadData::deref</a></div><div class="ttdeci">void deref()</div><div class="ttdef"><b>Definition:</b> <a href="qthread_8cpp_source.html#l00125">qthread.cpp:125</a></div></div>
<div class="ttc" id="classQThreadData_html_a58cb0e49ae8ee1830ca8bd9a4d2f4ef7"><div class="ttname"><a href="classQThreadData.html#a58cb0e49ae8ee1830ca8bd9a4d2f4ef7">QThreadData::get2</a></div><div class="ttdeci">static QThreadData * get2(QThread *thread)</div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00219">qthread_p.h:219</a></div></div>
<div class="ttc" id="qglobal_8h_html_ac70e1c2698aa808d9baf4bda9e9ee891"><div class="ttname"><a href="qglobal_8h.html#ac70e1c2698aa808d9baf4bda9e9ee891">qWarning</a></div><div class="ttdeci">Q_CORE_EXPORT void qWarning(const char *,...)</div></div>
<div class="ttc" id="qdbusmessage_8cpp_html_a4b86149e51ff4431f59ce6148820fb86"><div class="ttname"><a href="qdbusmessage_8cpp.html#a4b86149e51ff4431f59ce6148820fb86">data</a></div><div class="ttdeci">static const char * data(const QByteArray &amp;arr)</div><div class="ttdef"><b>Definition:</b> <a href="qdbusmessage_8cpp_source.html#l00060">qdbusmessage.cpp:60</a></div></div>
<div class="ttc" id="qglobal_8h_html_a91ad9478d81a7aaf2593e8d9c3d06a14"><div class="ttname"><a href="qglobal_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a></div><div class="ttdeci">unsigned int uint</div><div class="ttdef"><b>Definition:</b> <a href="qglobal_8h_source.html#l00996">qglobal.h:996</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a8495d64416823fd6ad3da3b12de0032f"><div class="ttname"><a href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a></div><div class="ttdeci">static QVector&lt; HANDLE &gt; qt_adopted_thread_handles</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00162">qthread_win.cpp:162</a></div></div>
<div class="ttc" id="classQMutex_html_a3d8f31a43c7e73ff4d95dd61fa9df82c"><div class="ttname"><a href="classQMutex.html#a3d8f31a43c7e73ff4d95dd61fa9df82c">QMutex::unlock</a></div><div class="ttdeci">void unlock()</div><div class="ttdoc">Unlocks the mutex. </div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8cpp_source.html#l00296">qmutex.cpp:296</a></div></div>
<div class="ttc" id="classQVector_html_a089ac11f22dec7de12a9ac819ab15175"><div class="ttname"><a href="classQVector.html#a089ac11f22dec7de12a9ac819ab15175">QVector::at</a></div><div class="ttdeci">const T &amp; at(int i) const</div><div class="ttdoc">Returns the item at index position i in the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00350">qvector.h:350</a></div></div>
<div class="ttc" id="classQThreadPrivate_html"><div class="ttname"><a href="classQThreadPrivate.html">QThreadPrivate</a></div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00137">qthread_p.h:137</a></div></div>
<div class="ttc" id="classQMutexLocker_html"><div class="ttname"><a href="classQMutexLocker.html">QMutexLocker</a></div><div class="ttdoc">The QMutexLocker class is a convenience class that simplifies locking and unlocking mutexes...</div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8h_source.html#l00101">qmutex.h:101</a></div></div>
<div class="ttc" id="namespaceMaemo_html_a06dd0ab7853d64c18382e2c13c5eecc8"><div class="ttname"><a href="namespaceMaemo.html#a06dd0ab7853d64c18382e2c13c5eecc8">Maemo::lock</a></div><div class="ttdeci">static QReadWriteLock lock</div><div class="ttdef"><b>Definition:</b> <a href="proxyconf_8cpp_source.html#l00399">proxyconf.cpp:399</a></div></div>
<div class="ttc" id="classQVector_html_a21bff276e9616d79bbce50ac4e6fce93"><div class="ttname"><a href="classQVector.html#a21bff276e9616d79bbce50ac4e6fce93">QVector::constData</a></div><div class="ttdeci">const T * constData() const</div><div class="ttdoc">Returns a const pointer to the data stored in the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00154">qvector.h:154</a></div></div>
<div class="ttc" id="classQThreadPrivate_html_a5024ce3be48b6aa59109c3cc4b55be97"><div class="ttname"><a href="classQThreadPrivate.html#a5024ce3be48b6aa59109c3cc4b55be97">QThreadPrivate::finish</a></div><div class="ttdeci">static void finish(void *)</div><div class="ttdef"><b>Definition:</b> <a href="qthread__unix_8cpp_source.html#l00356">qthread_unix.cpp:356</a></div></div>
<div class="ttc" id="classQThreadData_html_ac9aa336d53cb2749ffb38dba01a94265"><div class="ttname"><a href="classQThreadData.html#ac9aa336d53cb2749ffb38dba01a94265">QThreadData::thread</a></div><div class="ttdeci">QThread * thread</div><div class="ttdef"><b>Definition:</b> <a href="qthread__p_8h_source.html#l00260">qthread_p.h:260</a></div></div>
<div class="ttc" id="classQThread_html"><div class="ttname"><a href="classQThread.html">QThread</a></div><div class="ttdoc">The QThread class provides a platform-independent way to manage threads. </div><div class="ttdef"><b>Definition:</b> <a href="qthread_8h_source.html#l00059">qthread.h:59</a></div></div>
<div class="ttc" id="classQVector_html_a3b40ac78d8377b150a0467a7fe139eef"><div class="ttname"><a href="classQVector.html#a3b40ac78d8377b150a0467a7fe139eef">QVector::size</a></div><div class="ttdeci">int size() const</div><div class="ttdoc">Returns the number of items in the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00137">qvector.h:137</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a354f28b2077ff92dc5cf7df1f9503c0d"><div class="ttname"><a href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a></div><div class="ttdeci">static DWORD qt_adopted_thread_watcher_id</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00165">qthread_win.cpp:165</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a9b7c1454bb5a5c334bb45508dc27eb42"><div class="ttname"><a href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a></div><div class="ttdeci">static QVector&lt; QThread * &gt; qt_adopted_qthreads</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00163">qthread_win.cpp:163</a></div></div>
<div class="ttc" id="qglobal_8h_html_a8c25998f80abf59bbbc3fd3011d8bba6"><div class="ttname"><a href="qglobal_8h.html#a8c25998f80abf59bbbc3fd3011d8bba6">forever</a></div><div class="ttdeci">#define forever</div><div class="ttdoc">This macro is provided for convenience for writing infinite loops. </div><div class="ttdef"><b>Definition:</b> <a href="qglobal_8h_source.html#l02452">qglobal.h:2452</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a15ddb408c5845e2612a250750289c242"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15ddb408c5845e2612a250750289c242">&#9670;&nbsp;</a></span>qt_create_tls()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qt_create_tls </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the <a class="el" href="classQThread.html" title="The QThread class provides a platform-independent way to manage threads. ">QThread</a> system. </p>
<dl class="section warning"><dt>Warning</dt><dd>This function is not part of the public interface. </dd></dl>

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00078">78</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread_8cpp_source.html#l00643">QThread::initialize()</a>, <a class="el" href="qthread__win_8cpp_source.html#l00211">qt_adopted_thread_watcher_function()</a>, and <a class="el" href="qthread__win_8cpp_source.html#l00087">qt_free_tls()</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;{</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a> != <a class="code" href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a>)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keyword">static</span> <a class="code" href="classQMutex.html">QMutex</a> mutex;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="classQMutexLocker.html">QMutexLocker</a> locker(&amp;mutex);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a> = TlsAlloc();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div><div class="ttc" id="classQMutex_html"><div class="ttname"><a href="classQMutex.html">QMutex</a></div><div class="ttdoc">The QMutex class provides access serialization between threads. </div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8h_source.html#l00060">qmutex.h:60</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_ac99862afc48487079933197e551ca73b"><div class="ttname"><a href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a></div><div class="ttdeci">static DWORD qt_current_thread_data_tls_index</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00077">qthread_win.cpp:77</a></div></div>
<div class="ttc" id="qfunctions__wince_8h_html_aa4f45ea385abfbe9c4be9a0c1aa62f31"><div class="ttname"><a href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a></div><div class="ttdeci">#define TLS_OUT_OF_INDEXES</div><div class="ttdef"><b>Definition:</b> <a href="qfunctions__wince_8h_source.html#l00249">qfunctions_wince.h:249</a></div></div>
<div class="ttc" id="classQMutexLocker_html"><div class="ttname"><a href="classQMutexLocker.html">QMutexLocker</a></div><div class="ttdoc">The QMutexLocker class is a convenience class that simplifies locking and unlocking mutexes...</div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8h_source.html#l00101">qmutex.h:101</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa915ec62599a2134249c9a4a17cd8309"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa915ec62599a2134249c9a4a17cd8309">&#9670;&nbsp;</a></span>qt_free_tls()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void qt_free_tls </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00087">87</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a> != <a class="code" href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a>) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        TlsFree(<a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a> = <a class="code" href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div><div class="ttc" id="qthread__win_8cpp_html_ac99862afc48487079933197e551ca73b"><div class="ttname"><a href="qthread__win_8cpp.html#ac99862afc48487079933197e551ca73b">qt_current_thread_data_tls_index</a></div><div class="ttdeci">static DWORD qt_current_thread_data_tls_index</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00077">qthread_win.cpp:77</a></div></div>
<div class="ttc" id="qfunctions__wince_8h_html_aa4f45ea385abfbe9c4be9a0c1aa62f31"><div class="ttname"><a href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a></div><div class="ttdeci">#define TLS_OUT_OF_INDEXES</div><div class="ttdef"><b>Definition:</b> <a href="qfunctions__wince_8h_source.html#l00249">qfunctions_wince.h:249</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9447f5f4c4ae07dfe57b796bc010d1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9447f5f4c4ae07dfe57b796bc010d1b">&#9670;&nbsp;</a></span>qt_watch_adopted_thread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void qt_watch_adopted_thread </td>
          <td>(</td>
          <td class="paramtype">const HANDLE&#160;</td>
          <td class="paramname"><em>adoptedThreadHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classQThread.html">QThread</a> *&#160;</td>
          <td class="paramname"><em>qthread</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds an adopted thread to the list of threads that <a class="el" href="namespaceQt.html">Qt</a> watches to make sure the thread data is properly cleaned up. </p>
<dl class="section warning"><dt>Warning</dt><dd>This function is not part of the public interface. This function starts the watcher thread if necessary. </dd></dl>

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00176">176</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00087">qt_free_tls()</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="classQMutexLocker.html">QMutexLocker</a> <a class="code" href="namespaceMaemo.html#a06dd0ab7853d64c18382e2c13c5eecc8">lock</a>(&amp;<a class="code" href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (GetCurrentThreadId() == <a class="code" href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a>) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#if !defined(Q_OS_WINCE) || (defined(_WIN32_WCE) &amp;&amp; (_WIN32_WCE&gt;=0x600))</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        CloseHandle(adoptedThreadHandle);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>.<a class="code" href="classQVector.html#ad3536b6c85748f8b0b376d5d9ba0e721">append</a>(adoptedThreadHandle);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a>.append(qthread);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// Start watcher thread if it is not already running.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a> == 0) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a> == 0) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a> = CreateEvent(0, <span class="keyword">false</span>, <span class="keyword">false</span>, 0);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <a class="code" href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a>.<a class="code" href="classQVector.html#a94da89ec9a0c1b5205065ecf08ec1a7d">prepend</a>(<a class="code" href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        CreateThread(0, 0, <a class="code" href="qthread__win_8cpp.html#a6a9804f278dccdd88babcea470c4836d">qt_adopted_thread_watcher_function</a>, 0, 0, &amp;<a class="code" href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        SetEvent(<a class="code" href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="ttc" id="qthread__win_8cpp_html_a41ec7eac106dfdd48d235e69dc6f9d46"><div class="ttname"><a href="qthread__win_8cpp.html#a41ec7eac106dfdd48d235e69dc6f9d46">qt_adopted_thread_watcher_mutex</a></div><div class="ttdeci">static QMutex qt_adopted_thread_watcher_mutex</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00164">qthread_win.cpp:164</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a6a9804f278dccdd88babcea470c4836d"><div class="ttname"><a href="qthread__win_8cpp.html#a6a9804f278dccdd88babcea470c4836d">qt_adopted_thread_watcher_function</a></div><div class="ttdeci">DWORD WINAPI qt_adopted_thread_watcher_function(LPVOID)</div><div class="ttdoc">This function loops and waits for native adopted threads to finish. </div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00211">qthread_win.cpp:211</a></div></div>
<div class="ttc" id="classQVector_html_ad3536b6c85748f8b0b376d5d9ba0e721"><div class="ttname"><a href="classQVector.html#ad3536b6c85748f8b0b376d5d9ba0e721">QVector::append</a></div><div class="ttdeci">void append(const T &amp;t)</div><div class="ttdoc">Inserts value at the end of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00573">qvector.h:573</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a8495d64416823fd6ad3da3b12de0032f"><div class="ttname"><a href="qthread__win_8cpp.html#a8495d64416823fd6ad3da3b12de0032f">qt_adopted_thread_handles</a></div><div class="ttdeci">static QVector&lt; HANDLE &gt; qt_adopted_thread_handles</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00162">qthread_win.cpp:162</a></div></div>
<div class="ttc" id="classQMutexLocker_html"><div class="ttname"><a href="classQMutexLocker.html">QMutexLocker</a></div><div class="ttdoc">The QMutexLocker class is a convenience class that simplifies locking and unlocking mutexes...</div><div class="ttdef"><b>Definition:</b> <a href="qmutex_8h_source.html#l00101">qmutex.h:101</a></div></div>
<div class="ttc" id="namespaceMaemo_html_a06dd0ab7853d64c18382e2c13c5eecc8"><div class="ttname"><a href="namespaceMaemo.html#a06dd0ab7853d64c18382e2c13c5eecc8">Maemo::lock</a></div><div class="ttdeci">static QReadWriteLock lock</div><div class="ttdef"><b>Definition:</b> <a href="proxyconf_8cpp_source.html#l00399">proxyconf.cpp:399</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a4263225c63d4c2a778fdbe3a1b36d84f"><div class="ttname"><a href="qthread__win_8cpp.html#a4263225c63d4c2a778fdbe3a1b36d84f">qt_adopted_thread_wakeup</a></div><div class="ttdeci">static HANDLE qt_adopted_thread_wakeup</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00166">qthread_win.cpp:166</a></div></div>
<div class="ttc" id="classQVector_html_a94da89ec9a0c1b5205065ecf08ec1a7d"><div class="ttname"><a href="classQVector.html#a94da89ec9a0c1b5205065ecf08ec1a7d">QVector::prepend</a></div><div class="ttdeci">void prepend(const T &amp;t)</div><div class="ttdoc">Inserts value at the beginning of the vector. </div><div class="ttdef"><b>Definition:</b> <a href="qvector_8h_source.html#l00378">qvector.h:378</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a354f28b2077ff92dc5cf7df1f9503c0d"><div class="ttname"><a href="qthread__win_8cpp.html#a354f28b2077ff92dc5cf7df1f9503c0d">qt_adopted_thread_watcher_id</a></div><div class="ttdeci">static DWORD qt_adopted_thread_watcher_id</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00165">qthread_win.cpp:165</a></div></div>
<div class="ttc" id="qthread__win_8cpp_html_a9b7c1454bb5a5c334bb45508dc27eb42"><div class="ttname"><a href="qthread__win_8cpp.html#a9b7c1454bb5a5c334bb45508dc27eb42">qt_adopted_qthreads</a></div><div class="ttdeci">static QVector&lt; QThread * &gt; qt_adopted_qthreads</div><div class="ttdef"><b>Definition:</b> <a href="qthread__win_8cpp_source.html#l00163">qthread_win.cpp:163</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9b7c1454bb5a5c334bb45508dc27eb42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b7c1454bb5a5c334bb45508dc27eb42">&#9670;&nbsp;</a></span>qt_adopted_qthreads</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classQVector.html">QVector</a>&lt;<a class="el" href="classQThread.html">QThread</a> *&gt; qt_adopted_qthreads</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00163">163</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

</div>
</div>
<a id="a8495d64416823fd6ad3da3b12de0032f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8495d64416823fd6ad3da3b12de0032f">&#9670;&nbsp;</a></span>qt_adopted_thread_handles</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classQVector.html">QVector</a>&lt;HANDLE&gt; qt_adopted_thread_handles</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00162">162</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00211">qt_adopted_thread_watcher_function()</a>.</p>

</div>
</div>
<a id="a4263225c63d4c2a778fdbe3a1b36d84f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4263225c63d4c2a778fdbe3a1b36d84f">&#9670;&nbsp;</a></span>qt_adopted_thread_wakeup</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">HANDLE qt_adopted_thread_wakeup = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00166">166</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00176">qt_watch_adopted_thread()</a>.</p>

</div>
</div>
<a id="a354f28b2077ff92dc5cf7df1f9503c0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a354f28b2077ff92dc5cf7df1f9503c0d">&#9670;&nbsp;</a></span>qt_adopted_thread_watcher_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">DWORD qt_adopted_thread_watcher_id = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00165">165</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00211">qt_adopted_thread_watcher_function()</a>, and <a class="el" href="qthread__win_8cpp_source.html#l00176">qt_watch_adopted_thread()</a>.</p>

</div>
</div>
<a id="a41ec7eac106dfdd48d235e69dc6f9d46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41ec7eac106dfdd48d235e69dc6f9d46">&#9670;&nbsp;</a></span>qt_adopted_thread_watcher_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classQMutex.html">QMutex</a> qt_adopted_thread_watcher_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00164">164</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

</div>
</div>
<a id="ac99862afc48487079933197e551ca73b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac99862afc48487079933197e551ca73b">&#9670;&nbsp;</a></span>qt_current_thread_data_tls_index</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">DWORD qt_current_thread_data_tls_index = <a class="el" href="qfunctions__wince_8h.html#aa4f45ea385abfbe9c4be9a0c1aa62f31">TLS_OUT_OF_INDEXES</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="qthread__win_8cpp_source.html#l00077">77</a> of file <a class="el" href="qthread__win_8cpp_source.html">qthread_win.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="qthread__win_8cpp_source.html#l00211">qt_adopted_thread_watcher_function()</a>, <a class="el" href="qthread__win_8cpp_source.html#l00078">qt_create_tls()</a>, and <a class="el" href="qthread__win_8cpp_source.html#l00087">qt_free_tls()</a>.</p>

</div>
</div>
</div><!-- contents -->

<hr class="footer"/><address class="footer"><small><a href="https://dreamswork.github.io/qt4/">Qt 4.8 Source Code Browser</a></small></address>
</body>
</html>
